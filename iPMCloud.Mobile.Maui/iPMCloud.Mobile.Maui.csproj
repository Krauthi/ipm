<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <!-- Temporarily build only for Android on Linux -->
    <TargetFrameworks>net9.0-android</TargetFrameworks>
    <!-- Full target frameworks (restore for macOS builds): net9.0-android;net9.0-ios -->
    <!-- Uncomment to also build for Windows. Note that all MAUI libraries used must also support Windows. -->
    <!-- <TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net9.0-windows10.0.19041.0</TargetFrameworks> -->
    
    <OutputType>Exe</OutputType>
    <RootNamespace>iPMCloud.Mobile</RootNamespace>
    <UseMaui>true</UseMaui>
    <SingleProject>true</SingleProject>
    <ImplicitUsings>enable</ImplicitUsings>

    <!-- Display name -->
    <ApplicationTitle>iPM-Cloud</ApplicationTitle>

    <!-- App Identifier -->
    <ApplicationId>com.ipmcloud.ipm.mobile</ApplicationId>
    <ApplicationIdGuid>201CEFAB-590D-414F-9660-9EFF31FE2078</ApplicationIdGuid>

    <!-- Versions -->
    <ApplicationDisplayVersion>2.0.36</ApplicationDisplayVersion>
    <ApplicationVersion>1</ApplicationVersion>
    <Version>2.0.36</Version>
    <AssemblyVersion>2.0.0.0</AssemblyVersion>
    <FileVersion>2.0.0.0</FileVersion>

    <SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">14.0</SupportedOSPlatformVersion>
    <SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
    
    <NeutralLanguage>de-DE</NeutralLanguage>
    <Copyright>iPM-Cloud</Copyright>
  </PropertyGroup>

  <PropertyGroup Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">
    <SupportedOSPlatformVersion>14.0</SupportedOSPlatformVersion>
    <CodesignKey>iPhone Developer</CodesignKey>
    <CodesignProvision>Automatic</CodesignProvision>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net9.0-android|AnyCPU'">
    <Optimize>true</Optimize>
    <AndroidEnableSGenConcurrent>true</AndroidEnableSGenConcurrent>
    <AndroidUseAapt2>true</AndroidUseAapt2>
    <AndroidPackageFormat>apk</AndroidPackageFormat>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net9.0-android|AnyCPU'">
    <Optimize>false</Optimize>
    <AndroidPackageFormat>aab</AndroidPackageFormat>
    <AndroidUseAapt2>true</AndroidUseAapt2>
    <AndroidEnableMultiDex>true</AndroidEnableMultiDex>
    <AndroidLinkMode>None</AndroidLinkMode>
  </PropertyGroup>

  <ItemGroup>
    <!-- App Icon -->
    <!-- TODO: Create proper app icon SVG files -->
    <!-- <MauiIcon Include="Resources\AppIcon\appicon.svg" ForegroundFile="Resources\AppIcon\appiconfg.svg" Color="#512BD4" /> -->

    <!-- Splash Screen -->
    <!-- TODO: Create proper splash screen SVG -->
    <!-- <MauiSplashScreen Include="Resources\Splash\splash.svg" Color="#512BD4" BaseSize="128,128" /> -->

    <!-- Images -->
    <MauiImage Include="Resources\Images\*" />

    <!-- Custom Fonts -->
    <MauiFont Include="Resources\Fonts\*" />

    <!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
    <MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
  </ItemGroup>

  <ItemGroup>
    <!-- Core MAUI packages -->
    <PackageReference Include="FFImageLoading.Maui" Version="1.3.2" />
    <PackageReference Include="MetadataExtractor" Version="2.9.0" />
    <PackageReference Include="Microsoft.Maui.Controls" Version="9.0.120" />
    <PackageReference Include="Microsoft.Maui.Controls.Compatibility" Version="9.0.120" />
    <PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="9.0.0" />

    <!-- NuGet packages from original project - updated to MAUI-compatible versions -->
    <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
    <PackageReference Include="Microsoft.CSharp" Version="4.7.0" />
    <PackageReference Include="NLog" Version="5.3.4" />
    
    <!-- Google/Firebase services -->
    <PackageReference Include="Google.Cloud.Translation.V2" Version="3.2.0" />
    
    <!-- MAUI Community Toolkit -->
    <PackageReference Include="CommunityToolkit.Maui" Version="9.0.0" />
    <PackageReference Include="SixLabors.ImageSharp" Version="3.1.12" />
    <PackageReference Include="SixLabors.ImageSharp.Drawing" Version="2.1.7" />
    
    <!-- System packages -->
    <PackageReference Include="System.Net.Security" Version="4.3.2" />
    <PackageReference Include="System.Net.WebHeaderCollection" Version="4.3.0" />
    <PackageReference Include="System.Net.WebSockets.Client" Version="4.3.2" />
    <PackageReference Include="System.Private.ServiceModel" Version="4.10.0" />
    <PackageReference Include="System.Runtime.Serialization.Xml" Version="4.3.0" />
    <PackageReference Include="System.ServiceModel.Http" Version="4.10.0" />
    <PackageReference Include="System.ServiceModel.Primitives" Version="4.10.0" />
    <PackageReference Include="Xamarin.Google.Android.Play.Core" Version="1.10.3.20" />
    <PackageReference Include="Xamarin.GooglePlayServices.Base" Version="118.9.0.1" />
    <PackageReference Include="Xamarin.GooglePlayServices.Basement" Version="118.9.0.1" />
    <PackageReference Include="ZXing.Net.Maui" Version="0.6.0" />
    <PackageReference Include="ZXing.Net.Maui.Controls" Version="0.6.0" />
    
    <!-- These packages need to be updated to MAUI-compatible versions -->
    <!-- TODO: Find MAUI alternatives for these packages -->
    <!-- <PackageReference Include="Plugin.FirebasePushNotification" Version="3.4.35" /> -->
    <!-- <PackageReference Include="ZXing.Net.Mobile.Forms" Version="2.4.1" /> -->
    <!-- <PackageReference Include="Matcha.BackgroundService" Version="1.0.5478" /> -->
    <!-- <PackageReference Include="Xam.Plugin.Media" Version="5.0.1" /> -->
  </ItemGroup>

  <ItemGroup Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">
    <PackageReference Include="Xamarin.AndroidX.AppCompat" Version="1.7.0.6" />
    <PackageReference Include="Xamarin.AndroidX.Core" Version="1.17.0.1" />
    <!-- Temporarily commented out due to download issues -->
    <!-- <PackageReference Include="Xamarin.GooglePlayServices.Base" Version="118.6.0" /> -->
  </ItemGroup>

  <!-- Build Action None (project-specific files) -->
  <ItemGroup>
    <!-- Embedded resources for NLog configuration -->
    <EmbeddedResource Include="NLog.config">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </EmbeddedResource>
  </ItemGroup>

  <!-- Android-specific files -->
  <ItemGroup Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">
    <GoogleServicesJson Include="Platforms\Android\google-services.json" />
    <AndroidAsset Include="Platforms\Android\Assets\*.json" />
  </ItemGroup>

  <!-- iOS-specific files -->
  <ItemGroup Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">
    <BundleResource Include="Platforms\iOS\GoogleService-Info.plist">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </BundleResource>
    <None Include="Platforms\iOS\Info.plist" />
    <None Include="Platforms\iOS\Entitlements.plist" />
    <EmbeddedResource Include="Platforms\iOS\NLog.config">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </EmbeddedResource>
  </ItemGroup>
  <ItemGroup>
    <MauiXaml Update="vo\wso\checks\SignaturePadView.xaml">
      <Generator>MSBuild:Compile</Generator>
    </MauiXaml>
    <MauiXaml Update="vo\wso\TicketPage.xaml">
      <Generator>MSBuild:Compile</Generator>
    </MauiXaml>
  </ItemGroup>

</Project>
